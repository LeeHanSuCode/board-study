<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <!-- Bootstrap CDN -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>

    <script type="text/javascript">



        var code2 = "";

        //휴대전화 메세지 전송
        function sendMessage(){
            var tel = $("#tel").val();
            var username = $("#username").val();

            if(tel.length == 0 || tel==' '){
                alert('전화번호를 입력해주세요.')
                return
            }

            if(username.length == 0 || username==' '){
                alert('닉네임을 입력해주세요.')
                return
            }



            $.ajax({
                url : '/certification/find/phone/' + tel +'/' + username,
                type : 'post',
                dataType : 'text',
                success : function (data){
                    if(data == "error"){
                        alert('올바른 전화번호 형식을 입력해주세요.')
                        return
                    }else if(data == "error_username") {
                        alert('회원 이름이 일치하지 않습니다.')
                        return
                    }else{
                        alert('전송되었습니다.')
                        $("#certification").attr("readOnly",false);
                        $("#certification").attr("required",true);
                        $("#tel").attr("readOnly" , true);
                        code2 = data;
                    }
                }
            })

        }

        //메세지 인증
        function messageCertification(){
            var certification = $("#certification").val();
            var tel = $("#tel").val();

            if(certification.length != 4){
                alert('올바른 인증번호를 입력해주세요.')
                return
            }

            if(certification == code2){
                alert('인증되었습니다');
                $("#certification").attr("readOnly",true);
                $("#certificationButton").attr("disabled",true);
                $("#sendMessages").attr("disabled",true);
            }else{
                alert('잘못된 인증번호 입니다.');
                return
            }


            $.ajax({
                url : '/certification/find/phone/' + tel,
                type : 'post',
                dataType : 'text',
                success : function (id){
                        $("#successChk").text("회원님의 아이디는 " + id + '입니다.');
                }
            })
        }


    </script>


</head>

    <div class="form-group">
        <label for="username">이름</label>
        <input type="text" id="username"  class="form-control"
               placeholder="닉네임을 입력 하세요.">
    </div>

    <div class="form-group">
        <label for="tel">휴대폰 번호</label>
        <div class="input-group">
            <input type="tel" id="tel" class="form-control" placeholder="ex) xxx-xxxx-xxxx"  />
            <div class="input-group-append">
                <button type="button" class="btn btn-primary" id="sendMessages" th:onclick="|javascript:sendMessage()|">인증번호 전송</button>
            </div>
        </div>
    </div>
    <div class="form-group">
        <label for="certification">인증 번호</label>
        <div class="input-group">
            <input id="certification" type="text"   th:readonly="true"/>
            <div class="input-group-append">
                <button type="button" class="btn btn-primary" id="certificationButton" th:onclick="|javascript:messageCertification()|">인증</button>
            </div>
        </div>
        <span id="successChk"></span>
    </div>


</body>
</html>